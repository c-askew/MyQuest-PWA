<div class="content-box">
  <div id="accountInfo">

  </div>
  <div class="viewForm" id="viewForm">
    <div class="input-field">
      <label class="active">Your School:</label>
      <input value="Unselected" type="text" readonly>
    </div>
    <div class="input-field">
      <label class="active">Group Name:</label>
      <input value="Unselected" type="text" readonly>
    </div>
  </div>
  <div class="editForm hide" id="editForm">
    <div class="selectRow">
      <label class="selectLabel">Select a School</label>
      <select id="schoolSelect">
        <optgroup label="Select">
          <option value="">Select One...</option>
          <option value="1">Computing, Media & The Arts</option>
          <option value="2">Science, Engineering & Design</option>
          <option value="3">Teesside University Business School</option>
          <option value="4">Social Sciences, Humanities & Law</option>
        </optgroup>
      </select>
    </div>
    <div class="input-field">
      <label class="active">Group Name:</label>
      <input id="groupInput" value="Unselected" type="text">
    </div>
  </div>

  <div class="profileBtns">
    <button class="buttons-2" id="edit">Edit</button>
    <button class="buttons-2 hide" id="save">Save Changes</button>
    <button class="buttons-2" id="logout">Logout</button>
  </div>
</div>

<script>
  $(document).ready(function() {
    $('select').material_select();
  });

  const btnEdit = document.getElementById("edit");
  const editForm = document.getElementById("editForm");
  const btnSave = document.getElementById("save");
  const viewForm = document.getElementById("viewForm");
  btnEdit.addEventListener('click', e => {
    editForm.classList.remove('hide');
    viewForm.classList.add('hide');
    btnSave.classList.remove('hide');
  })

  btnSave.addEventListener('click', e => {
    saveChanges();
    editForm.classList.add('hide');
    viewForm.classList.remove('hide');
    btnSave.classList.add('hide');
  })

  const btnLogout = document.getElementById("logout");
  btnLogout.addEventListener('click', e => {
    firebase.auth().signOut();
    changeAppPage("homeScreen");
  })

  var database = firebase.database();
  var user = firebase.auth().currentUser;
  var name, email, photoUrl, uid, emailVerified;
  name = user.displayName;
  email = user.email;
  photoUrl = user.photoURL;
  emailVerified = user.emailVerified;
  uid = user.uid;
  const fallbackImg = "https://42f2671d685f51e10fc6-b9fcecea3e50b3b59bdc28dead054ebc.ssl.cf5.rackcdn.com/illustrations/profile_pic_ic5t.svg";
  var userRef = firebase.database().ref('users/' + uid);

  initUser(uid,name,email,photoUrl);
  // console.log("Name: " + name)
  // console.log("Email: " + email)
  // console.log("PhotoURL: " + photoUrl)
  // console.log("UID: " + uid)

function initUser(userId, name, email, photo) {
  console.log("initUser start");
    userRef.set({
      username: name,
      email: email,
      photoUrl: photo
    });
  getData();
  displayProfile();
}

function getData() {
  return userRef.once('value').then(function(snapshot) {
    var school = snapshot.val().school;
    var groupName = snapshot.val().groupName;
  // ...
});
}

function saveChanges() {
  var schoolSelection = document.getElementById("schoolSelect");
  var school = schoolSelection.options[schoolSelection.selectedIndex].text;
  var groupName = document.getElementById("groupInput").value;
  console.log(school)
  console.log(groupName)
  userRef.push({
    school: school,
    groupName: groupName
  })
}

function displayProfile() {
  console.log("display profile")
  var profileBox = document.getElementById('accountInfo');
  console.log(photoUrl)
  $("<div>", {id: 'userInfo', class:'profileValue'})
    .append("<h2 id=\"userName\">" + name + "</h2>")
    //Apply Image with Fallback image using onerror value
    .append("<img id=\"userPhoto\" src=\"" + photoUrl +"\" onerror=\"this.src=\'" + fallbackImg + "\';\"/>")
    .append("<p id=\"userEmail\">" + email + "</p>")
    .appendTo(profileBox)
}



</script>
